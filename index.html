<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWTCH Install App Download</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- QR Code generation library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Center the QR code canvas generated by the library */
        #qrcode canvas, #qrcode img {
            display: block;
            margin: auto;
        }
    </style>
</head>
<body class="bg-gray-200 flex items-center justify-center min-h-screen p-4">

    <!-- This container is styled to look exactly like your sticker design -->
    <div id="main-content" class="sticker-container w-full max-w-sm bg-white rounded-2xl shadow-lg p-8 flex flex-col items-center">
        
        <header class="text-center w-full">
            <h1 class="text-3xl font-bold text-black tracking-wide">SWTCH INSTALL App</h1>
            <p class="text-lg text-gray-700 mt-3 leading-snug">Self-commission your chargers-fast. Take full control and get them online in minutes. No delays or need to go back to sites.</p>
        </header>

        <div class="my-6 w-full text-left pl-4">
             <div class="flex items-center text-lg text-gray-800 mb-2">
                <!-- Checkbox Icon -->
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h18v18H3z"></path></svg>
                <span>Download the app</span>
            </div>
             <div class="flex items-center text-lg text-gray-800">
                <!-- Play Icon -->
                <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>
                <span>Watch the step-by-step video tutorial</span>
            </div>
        </div>

        <!-- Container for the functional QR Code -->
        <div id="qrcode-container" class="my-4">
            <div id="qrcode"></div>
        </div>

        <div class="important-notice w-full bg-white border-2 border-black p-4 rounded-lg text-center mt-4">
            <p class="font-bold text-black">Important: <span class="font-normal">A new SWTCH project must be created at least 24 hours before commissioning. Chargers cannot be commissioned without this step.</span></p>
        </div>

        <footer class="mt-8">
            <!-- Using the live SWTCH logo from assets -->
            <img src="https://assets-global.website-files.com/65a82424a459015849856a36/65a8257004353944a034f19b_SWTCH%20Logo.svg" alt="SWTCH Energy Logo" class="h-8 mx-auto">
        </footer>
    </div>

    <script>
        // --- Configuration ---
        const config = {
            iosUrl: 'https://apps.apple.com/ca/app/swtch-install/id6740869501',
            androidUrl: 'https://play.google.com/store/apps/details?id=com.swtchenergy.cih&pcampaignid=web_share',
            fallbackUrl: 'https://swtchenergy.com/install/step-2/?token=714a191c3cef94d1d00b'
        };

        // --- Main Logic ---
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const shouldRedirect = urlParams.has('redirect');

            if (shouldRedirect) {
                // This logic runs ONLY when the QR code is scanned.
                handleRedirect();
            } else {
                // This logic runs when the page is loaded normally to display the sticker.
                displayQrCode();
            }
        });

        /**
         * Detects the user's OS and redirects them to the appropriate URL.
         */
        function handleRedirect() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            const mainContent = document.getElementById('main-content');
            
            // Hide the main content and show a redirecting message
            if(mainContent) {
                mainContent.innerHTML = `
                    <div class="text-center">
                        <h1 class="text-2xl font-bold text-gray-800">Redirecting...</h1>
                        <p class="text-gray-500 mt-2">Please wait while we take you to the correct app store.</p>
                    </div>
                `;
            }

            // iOS detection
            if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                window.location.replace(config.iosUrl);
            }
            // Android detection
            else if (/android/i.test(userAgent)) {
                window.location.replace(config.androidUrl);
            }
            // Fallback for desktops or other OS
            else {
                window.location.replace(config.fallbackUrl);
            }
        }

        /**
         * Generates and displays the QR code on the sticker page.
         */
        function displayQrCode() {
            const qrCodeElement = document.getElementById('qrcode');

            if (!qrCodeElement) {
                console.error("QR code container element not found.");
                return;
            }

            // The URL the QR code will point to. It's the current page's URL with "?redirect=true" appended.
            const redirectUrl = window.location.origin + window.location.pathname + '?redirect=true';

            // Generate the QR code
            new QRCode(qrCodeElement, {
                text: redirectUrl,
                width: 200, // Adjusted size to fit the design
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }
    </script>

</body>
</html>
